<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"  class="no-js" lang="zxx">
<!-- include/layout.html-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<th:block th:replace="~{/include/layout :: setContent( ~{:: #wrap}  ) }">
    <section id="wrap">
    </section>
</th:block>
<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>

<div class="mobile-menu-overlay"></div>

<div class="main-container" >
    <div class="pd-ltr-20 xs-pd-20-10">
        <div class="min-height-200px">
            <div class="page-header">
                <div class="row">
                    <div class="col-md-6 col-sm-12">
                        <div class="title">
                            <h4>신입 사원 조회</h4>
                        </div>
                        <nav aria-label="breadcrumb" role="navigation">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a>인사 관리</a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">
                                    전체 목록
                                </li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
            <div class="pd-20 card-box mb-30" >
                <h4 class="h4 text-blue mb-10" > 신입 사원 목록 </h4>
                <p>
                    <button id="confirmNewEmp">승인</button>
                <div id="grid" ></div>
                </p>
            </div>
        </div>
    </div>
</div>
<!-- 모달창 -->
<!--<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">-->
<!--    <div class="modal-dialog">-->
<!--        <div class="modal-content">-->
<!--            <div class="modal-header">-->
<!--                <h1 class="modal-title fs-5" id="exampleModalLabel">신입 사원 정보</h1>-->
<!--                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>-->
<!--            </div>-->
<!--            <div class="modal-body">-->
<!--                <form>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="newId" class="col-form-label">신입 사원 번호</label>-->
<!--                        <input type="text" class="form-control" id="newId">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="newName" class="col-form-label">이름</label>-->
<!--                        <input type="text" class="form-control" id="newName">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="empAddr" class="col-form-label">주소</label>-->
<!--                        <input type="text" class="form-control" id="empAddr">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="newPhone" class="col-form-label">이메일</label>-->
<!--                        <input type="text" class="form-control" id="newPhone">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="newIdNum" class="col-form-label">주민번호</label>-->
<!--                        <input type="text" class="form-control" id="newIdNum">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="newEmail" class="col-form-label">이메일</label>-->
<!--                        <input type="text" class="form-control" id="newEmail">-->
<!--                    </div>-->
<!--                    <div class="mb-3">-->
<!--                        <label for="newDept" class="col-form-label">지원 직무</label>-->
<!--                        <input type="text" class="form-control" id="newDept">-->
<!--                    </div>-->
<!--                    -->
<!--                    -->
<!--                    -->
<!--                    -->
<!--&lt;!&ndash;                    <div class="mb-3">&ndash;&gt;-->
<!--&lt;!&ndash;                        <label for=" " class="col-form-label">제출 여부</label>&ndash;&gt;-->
<!--&lt;!&ndash;                        <input type="text" class="form-control">&ndash;&gt;-->
<!--&lt;!&ndash;                    </div>&ndash;&gt;-->
<!--&lt;!&ndash;                    <div class="mb-3">&ndash;&gt;-->
<!--&lt;!&ndash;                        <label for=" " class="col-form-label">관리</label>&ndash;&gt;-->
<!--&lt;!&ndash;                        <input type="text" class="form-control" >&ndash;&gt;-->
<!--&lt;!&ndash;                    </div>&ndash;&gt;-->
<!--                </form>-->
<!--            </div>-->
<!--            <div class="modal-footer">-->
<!--                <button type="button" class="btn btn-primary">수정</button>-->
<!--                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->



<!-- buttons for Export datatable -->
<!--<script src="/plugins/datatables/js/dataTables.buttons.min.js"></script>-->
<!--<script src="/plugins/datatables/js/buttons.print.min.js"></script>-->
<!--<script src="/plugins/datatables/js/buttons.html5.min.js"></script>-->
<!--<script src="/plugins/datatables/js/buttons.flash.min.js"></script>-->
<!--<script src="/plugins/datatables/js/pdfmake.min.js"></script>-->
<!--<script src="/plugins/datatables/js/vfs_fonts.js"></script>-->





<!-- js --><!--
		<script src="vendors/scripts/core.js"></script>
		<script src="vendors/scripts/script.min.js"></script>
		<script src="vendors/scripts/process.js"></script>
		<script src="vendors/scripts/layout-settings.js"></script>-->
<link rel="stylesheet" href="https://uicdn.toast.com/tui.pagination/latest/tui-pagination.css" />
<script type="text/javascript" src="https://uicdn.toast.com/tui.pagination/v3.4.0/tui-pagination.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
<script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
<script>


</script>


<!--위에 선언하면 html보다 이 script가 더 빨리 로딩 되서 null 값어가 ㅜ항상 아래쪽에 위치해줘야되나봐 ~! -->
<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
<script src="/src/plugins/sweetalert2/sweetalert2.all.js"></script>
<script src="/src/plugins/sweetalert2/sweet-alert.init.js"></script>

<script>


    //모달창 세팅
    // const modalToggle = document.getElementById('exampleModal');
    // const myModal = new bootstrap.Modal(document.getElementById('exampleModal'));


    //신규직원 그리드 세팅 하는 변수
    const newEmpList = []; //1. 변수 선언

    // const newList = /*[[${newEmpList}]]*/ [];
    console.log(newEmpList);

    // 데이터 소스에 newAddrs 필드 추가
    // newEmpList.forEach(function(item) {
    //     item.newAddrs = item.newAddr + ', ' + item.newDetailAddr + ', ' + item.newZipcode;
    // });

    const grid = new tui.Grid({
        el: document.getElementById('grid'),
        // data: newEmpList,
        scrollX: true,
        scrollY: true,
        rowHeaders: ['checkbox'],
        columns: [
            {
                header: '신입사원 번호',
                name: 'newId',
                align: 'center'
            },
            {
                header: '이름',
                name: 'newName',
                filter: 'select',
                align: 'center'
            },
            {
                header: '전화 번호',
                name: 'newPhone',
                align: 'center'
            },
            {
                header: '주소',
                name: 'newAddr',
                align: 'center'
            },
            {
                header: '생년월일',
                name: 'newBirth',
                filter: 'select',
                align: 'center'
            },
            {
                header: '지원 직무',
                name: 'newDept',
                filter: 'select',
                align: 'center'
            },
            {
                header: '직급',
                name: 'newGrade',
                filter: 'select',
                align: 'center',
                // formatter: (value) => {
                //
                //     let position = '';
                //     switch (value) {
                //         case 'EMPLOYEE':
                //             position = '사원';
                //             break;
                //         case 'ASSISTANT':
                //             position = '대리';
                //             break;
                //         case 'MANAGER':
                //             position = '과장';
                //             break;
                //         case 'DEPUTY':
                //             position = '차장';
                //             break;
                //         case 'HR':
                //             position = '인사관리';
                //             break;
                //         case 'ADMIN':
                //             position = '관리자';
                //             break;
                //         case '"EMPLOYEE"':
                //             position = '공란';
                //             break;
                //         default:
                //             position = '미정';
                //     }
                //     return position;
                // }
            }
        ],
        pageOptions: {
            useClient: true,
            perPage: 10
        }
    });



    fetch('/hr/new-list')
        .then(function(res){
            return res.json();
        })
        .then(function(newEmpData){
            //직급 변환하여 출력
            const gradeData = newEmpData.map(item => {
                let position = '';
                switch (item.newGrade) {
                    case 'EMPLOYEE':
                        position = '사원';
                        break;
                    case 'ASSISTANT':
                        position = '대리';
                        break;
                    case 'MANAGER':
                        position = '과장';
                        break;
                    case 'DEPUTY':
                        position = '차장';
                        break;
                    case 'HR':
                        position = '인사관리';
                        break;
                    case 'ADMIN':
                        position = '관리자';
                        break;
                    default:
                        position = '미정';
                }
                return { ...item, newGrade: position };
            })
            grid.resetData(gradeData); //값 넣고 grid reset한다.
        });



    //그리드 클릭 시 이벤트
    // grid.on('click',function(ev){
    //     console.log(ev); // 그리드에서 제공하는 클릭 이벤트의 매개변수 값을 보기 위함
    //     const row = grid.getRow(ev.rowKey); //gird에서 제공하는 함수 로우키를 넣으면 해당하는 행의 값들을 보여줌
    //     console.log(row);
    //     document.getElementById('newId').value = row.newId;
    //     document.getElementById('newName').value = row.newName;
    //     document.getElementById('newIdnum').value = row.newIdnum;
    //     document.getElementById('newPhone').value = row.newPhone;
    //     document.getElementById('newAddr').value = row.newAddr;
    //     document.getElementById('newEmail').value = row.newEmail;
    //     document.getElementById('newDept').value = row.newDept;
    //
    //     myModal.show(myModal);
    //
    // })





    // window.onload = function() {
    //     loadNewEmpList();
    // };

    // function updateNewEmpList() {
    //     const grid = tui.Grid.getInstance(document.getElementById('grid'));
    //
    //     $.ajax({
    //         type: 'GET',
    //         url: '/hr/new-emp-list',
    //         dataType: 'json',
    //         success: function (newEmpData) {
    //             grid.resetData(newEmpData);
    //         },
    //         error: function (error) {
    //             alert(JSON.stringify(error));
    //         },
    //     });
    // }



    // 신규직원 승인하는 이벤트
    document.getElementById("confirmNewEmp").addEventListener('click',function(){
        console.log("confirmNewEmp clicked")
        var header = $("meta[name='_csrf_header']").attr('content');
        var token = $("meta[name='_csrf']").attr('content');
        $(document).ajaxSend(function(e,xht,options){
            xht.setRequestHeader(header ,token);
        });

        let newEmpChecked = grid.getCheckedRows(); // grid에서 체크시 체크한 항목 보여줌


        console.log(newEmpChecked);

        if(newEmpChecked.length == 0){
            alert('승인대상을 선택해주세요.');
            return false;
        }else{
            let result = confirm('승인하시겠습니까?'); //확인 true 취소 false
            if(result){
                $.ajax({
                    type:'POST',
                    url: '/hr/confirm-new-emp',
                    dataType:'json',
                    contentType: 'application/json;charset=utf-8',
                    data: JSON.stringify(newEmpChecked),
                    success: function(confirmResult) {
                        if (confirmResult >= 1) {
                            alert('승인을 완료하였습니다.');
                            updateNewEmpList();
                        } else {
                            alert('승인을 실패하였습니다.');
                        }
                    },
                    error: function(error){
                        alert(JSON.stringify(error));
                    }
                });
                return false; // 이벤트 종료
            }
        }
    });

</script>


<!-- Google Tag Manager (noscript) -->

<noscript
><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-NXZMQSS"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
></iframe
></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>